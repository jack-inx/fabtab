var lastRefreshTime=null,reloadUserAds=function(){var a=lastRefreshTime===null?"/ads.json":"/ads.json?modified_since="+lastRefreshTime;$.get(a,function(a,b,c){updateAdsByEveryone(a),lastRefreshTime=c.getResponseHeader("date")})},top_carousel_refresh=function(){$("#optin_ads_carousel li:visible").length<3&&$("#optin_ads_carousel li:hidden:first").show(),$("#optin_ads_pagination").remove(),$("#optin_ads_carousel").easyPaginate({step:3,controls:"optin_ads_pagination"})},updateAdsByEveryone=function(a){if(a.length>0){for(var b=0;b<a.length;b++){$("#saved_ads_carousel li[style*='list-item']:last").hide();var c=$(".template").clone();c.children("div").removeClass("hidden"),c.removeClass("template"),a[b].ad_type=="video"?(c.find(".ad_image").append("<iframe src="+a[b].image_url+" width=216 height=180 border='none'></iframe>"),c.find(".ad_image img").hide()):c.find("img")[0].src=a[b].image_url,c.find(".site")[0].innerHTML=decodeURIComponent(a[b].url).split("/")[2],c.find("#url:first").val(function(){return a[b].url}),c.find("#ad_type:first").val(function(){return a[b].ad_type}),a[b].group.user&&(c.find(".user span")[0].innerHTML=a[b].group.user.nickname,$("#saved_ads_carousel").prepend(c))}$("#temp_pagination").remove();var d=$("#saved_ads_carousel").easyPaginate({step:4,controls:"temp_pagination"});d.show()}};$(document).ready(function(){reloadUserAds(),$.ajax({url:"/setting",type:"GET",success:function(a,b,c){setInterval(reloadUserAds,a.carousel_refresh*1e3)}}),$(document).on({mouseenter:function(){$(this).find(".tabit-button:first").removeClass("hidden")},mouseleave:function(){$(this).find(".tabit-button:first").addClass("hidden")}},"#saved_ads_carousel li"),$(document).on("click","#saved_ads_carousel li .tabit-button",function(){var a=this;$(".tabit_dialog").clone().appendTo($(a).parent());var b=$(a).parent().children(".tabit_dialog");return b.removeClass("hidden"),b.find("#ad_url").val(function(){return $(a).parent().find(".ad_details #url").val()}),b.find("#ad_ad_type").val(function(){return $(a).parent().find(".ad_details #ad_type").val()}),b.find("#ad_image_url").val(function(){return $(a).parent().find("iframe").length>0?$(a).parent().find("iframe").attr("src"):$(a).parent().find("img").attr("src")}),b.find(".tabit").click(function(){return $.ajax({url:b.find("form:first").attr("action"),type:"POST",data:b.find("form:first").serialize(),success:function(c,d,e){var f=b.find("#ad_image_url").val();return $("#optin_ads_carousel .group[data-folder='"+c+"']").length>0?((new MyFabTab.Folder("#optin_ads_carousel .group[data-folder='"+c+"']")).add(f,$("#ad_ad_type").val()),$(a).parent().children(".tabit_dialog").remove(),$(a).parent().find(".tabit-button:first").addClass("hidden")):location.reload(),!1}}),!1}),b.find(".cancel").click(function(c){return b.remove(),$(a).addClass("hidden"),!1}),!1}),$("#optin_ads_carousel li").hover(function(){$(this).children(".edit-button").removeClass("hidden")},function(){$(this).children(".edit-button").addClass("hidden"),$(this).children(".edit_dialog").addClass("hidden"),$(this).find(".delete_dialog:first").addClass("hidden")}),$("#optin_ads_carousel li .edit-button").click(function(a){var b=this,c=$(b).parent().children(".edit_dialog");c.removeClass("hidden");var d=c.find("form:first").attr("action");return c.find(".save:first").click(function(){return $.ajax({url:d,type:"PUT",data:c.find("form:first").serialize(),success:function(a,d,e){a.new_group?($(b).parent().remove(),top_carousel_refresh()):($(b).parent().find(".folder-category:first").html(a.category),c.find("form #category option:first").attr("selected",!0)),$(b).parent().children(".edit_dialog").addClass("hidden"),$(b).parent().children(".edit-button").addClass("hidden")}}),!1}),c.find(".delete").click(function(){return c.parent().find(".delete_dialog").removeClass("hidden"),c.parent().find(".delete_dialog .delete_folder").click(function(){return $.ajax({url:d,type:"DELETE",data:c.find("form").serialize(),success:function(a,c,d){$(b).parent().remove(),top_carousel_refresh()}}),!1}),!1}),!1})})